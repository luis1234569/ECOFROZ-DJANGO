{% extends 'base_calendar.html' %}
<!-- {% load tz %}   -->

{% block extrahead %}

<style type="text/css"> 
  thead th  { 
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: #ffffff;
      border: blue 2px solid;
      
  }

  tr td  { 
      
      border: rgb(209, 209, 226) 1px solid;
      
  }

  .table { 
      height:200px;
      overflow:scroll;
      font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
      border-collapse: collapse;
      width: 100%;
  }

  

  th, td {
    word-wrap: break-word;
    text-align: left;
   padding: 8px;
}

ul.ui-autocomplete {
    z-index: 1100;
}

</style>



{% endblock %}



{% block content %}
<div class="container" style="margin: 25px auto;">
  <div class="row">
    <div class="col-md-4">
      <a href="{% url 'procesosadministrativos:listar_solicitudes_transporte' %}" class="btn btn-primary">Ver Mis Solicitudes</a>
    </div>
    <div class="col-md-2" style="text-align:right">
      <i class="glyphicon glyphicon-certificate" style="font-size: 1rem; color:#74DF00"></i><label>F. Quillupangui&nbsp;&nbsp;</label>
    </div>
    <div class="col-md-2">
     <i class="glyphicon glyphicon-certificate" style="font-size: 1rem; color:#0080FF"></i> <label for="">L.Tapia</label>
    </div> 
    <div class="col-md-2">
      <i class="glyphicon glyphicon-certificate" style="font-size: 1rem; color:#FF0040"></i> <label for="">J.Tipantiza&nbsp;</label>
     </div> 
     <div class="col-md-2">
      <i class="glyphicon glyphicon-certificate" style="font-size: 1rem; color:#FE9A2E"></i> <label for="">P.Bunse&nbsp;</label>
     </div> 
  </div>
  
  
  <div class="col-md-12">
    <br>
      <div id = 'calendar'></div>
  </div>
</div>

<div class="modal fade" id="Add-Event" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="True">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Agregar Información del Evento</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hideen="True">&times;</span>
        </button>
      </div>
      <form action="">
        {% csrf_token %}
      <div class="modal-boddy">
        <div class="container">
          <div class="form-group">
          <input type="checkbox" id="camioneta1" name="camioneta1" value="camioneta1" onclick="oculta()">
          <label for="camioneta1">Camioneta Administración</label>
        </div>
        <div class="form-group" id="nombre_evento">
          <label for="">Nombre del Evento</label>
          <input type="text" class="form-control" name="title" id="title" placeholder="Ingrese nombre del evento">
        </div>
        <!-- <div class="form-group">
          <label for="">Escoja un color</label>
          <input type="color" class="form-control" name="color" value="#006ab4"> 
        </div>  -->
        <div class="form-group">
          <div class="row">
            <div class="col-md-5">

          
          <label for="">Inicio</label>
          <input type="datetime-local" class="form-control" name="start" id="start" placeholder="Ingrese Fecha de Inicio">
        </div>

        <div class="col-md-5">

          <label for="">Fin</label>
          <input type="datetime-local" class="form-control" name="end" id="end" placeholder="Ingrese Fecha de Fin">
        </div>
        <div class="col-md-2">

          <label for="">Asientos</label>
          <select name="asientos" class="form-control">
            <option value="0" default>--</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>
      
      
      </div>
        </div>



        <div class="form-group" id="evento_desc">
          <label for="">Información Adicional</label>
          <textarea class="form-control" name="desc" id="desc" rows="3"></textarea>
        </div>
      </div>
        </div>

      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" onclick="nuevo_evento()">Guardar</button>
        </div>
      </form>
      </div>
    </div>
  </div>


  <div class="modal fade" id="Show-Event" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="True">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Información del Evento</h5>
          <button type="button" class="close" data-dismiss="modal" id="cierra-arriba" name="cierra-arriba" aria-label="Close">
            <span aria-hideen="True">&times;</span>
          </button>
        </div>
        <form action="">
          {% csrf_token %}
        <div class="modal-boddy">
          <div class="container">
            <!-- <div class="form-group">
            <input type="checkbox" id="camioneta1sw" name="camioneta1sw">
            <label for="camioneta1">Camioneta Administración</label>
          </div> -->
          <div class="form-group" id="nombre_evento">
            <label for="">Nombre del Evento</label>
            <input type="text" class="form-control" name="titlesw" id="titlesw" readonly style="background-color:white">
          </div>
          <!-- <div class="form-group">
            <label for="">Escoja un color</label>
            <input type="color" class="form-control" name="color" value="#006ab4"> 
          </div>  -->
          <div class="form-group">
            <div class="row">
              <div class="col-md-6">
            <label for="">Fecha de Inicio</label>
            <input type="datetime-local" class="form-control" name="startsw" id="startsw" readonly style="background-color:white">
          </div>
        
          <div class="col-md-6">
            <label for="">Fecha de Fin</label>
            <input type="datetime-local" class="form-control" name="endsw" id="endsw" readonly style="background-color:white">
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="row">
          <div class="col-md-12">
        <label for="">Ruta</label>
        <input type="text" class="form-control" name="rutasw" id="rutasw" readonly style="background-color:white">
      </div>
    </div>
  </div>
    
      <div class="form-group">
        <div class="row">
      <div class="col-md-10">
        <label for="">Transportista</label>
        <input type="text" class="form-control" name="transposw" id="transposw" readonly style="background-color:white">
      </div>
      <div class="col-md-2">
        <label for="">Asientos</label>
        <input type="text" class="form-control" name="asientossw" id="asientossw" readonly style="background-color:white" title="Disponibles">
      </div>
    </div>
  </div>
  
  <input type="text" class="form-control" name="id" id="id" hidden>
  
          <div class="form-group" id="evento_desc">
            <label for="">Notas</label>
            <textarea class="form-control" name="descsw" id="descsw" rows="2" readonly style="background-color:white"></textarea>
          </div>
        </div>
          </div>
  
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cierrasw" name="cierrasw" data-dismiss="modal">Cerrar</button>
          <button type="button" onclick="booking()" class="btn btn-info" id="bookingsw" name="bookingsw">Solicitar asiento</button>
          </div>
        </form>
        </div>
      </div>
    </div>
    

    <div class="modal fade" id="Show-Booking" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="True">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Booking</h5>
            <button type="button" class="close" data-dismiss="modal" id="cierra-arribabk" name="cierra-arribabk" aria-label="Close">
              <span aria-hideen="True">&times;</span>
            </button>
          </div>
          <form action="">
            {% csrf_token %}
          <div class="modal-boddy">
            <div class="container">
              <!-- <div class="form-group">
              <input type="checkbox" id="camioneta1sw" name="camioneta1sw">
              <label for="camioneta1">Camioneta Administración</label>
            </div> -->
            <div class="form-group" id="departamentofg">
              <label for="">Departamento</label>
              <input type="text" class="form-control" name="departamento" id="departamento" placeholder="Digite y seleccione el departamento">
            </div>
            
            <div class="form-group">
              <div class="row">
                <div class="col-md-12">
              <label for="">Nombre del Pasajero</label>
              <input type="text" class="form-control" name="pasajero" id="pasajero" placeholder="Digite el nombre o apellido del pasajero">
            </div>
          
          </div>
        </div>

        <div class="form-group" id="evento_desc">
          <label for="">Justificación Viaje</label>
          <textarea class="form-control" name="justificacion" id="justificacion" rows="3"></textarea>
        </div>
     
        <input type="text" class="form-control" name="idbk" id="idbk" hidden>
        
    
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cierrabk" name="cierrabk" data-dismiss="modal">Cerrar</button>
            <button type="button" class="btn btn-primary" id="grababk" name="grababk">Enviar</button>
            </div>
          </form>
          </div>
        </div>
      </div>
    


</div>

     
{% endblock %}

{% block extrajs %}
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->

<script>


$(document).ready(function(){
    
    $("#departamento").autocomplete({source: "{% url 'procesosadministrativos:ajaxcalldepar' %}"
  
  })

    $("#pasajero").autocomplete({source: "{% url 'procesosadministrativos:ajaxcallpasajero' %}"
  
  });

  

});

function booking(){
  var id =  document.getElementById('id').value;
  
  $("#Show-Event").modal('hide');
  $("#Show-Booking").modal('show');
  idbk.value = id;
  document.getElementById('cierrabk').onclick = function() {
          $('#Show-Booking').modal('hide'); 
        }

  document.getElementById('cierra-arribabk').onclick = function() {
    $('#Show-Booking').modal('hide'); 
  }

}


function save_booking(){
    var depar =  document.getElementById('departamento').value;
    var pasajero =  document.getElementById('pasajero').value;
    var evento_id =  document.getElementById('idbk').value;
    var justifica = document.getElementById('justificacion').value;
    var tipo = 1;
    
        $.ajax({
        type:"GET",
        url:'ajax_save_booking/',
        data: {'depar': depar, 'pasajero': pasajero, 'evento_id': evento_id,'justifica':justifica,'tipo':tipo},
        dataType: "json",
        success: function (data) {
          console.log(data.status);
          calendar.fullCalendar('refetchEvents');
              alert("Actualizado satisfactoriamente");
          
        
        },
        error: function (data) {
          alert("No se pudo guardar. Comuníquese con IT");
         
        },
        
      })
      }
      

function oculta(){
  const cb = document.querySelector('#camioneta1');
  if (cb.checked == true){

  $("#nombre_evento").hide();
  $("#evento_desc").hide();
  }
  else{
    $("#nombre_evento").show();
    $("#evento_desc").show();

  }
}

function borra_evento(event){
   if (confirm("Está seguro que desea eliminar?")){
          var id = event.id;
          $.ajax({
          type:"GET",
          url:"remove_event/",
          data: {'id': id},
          dataType: "json",
          success: function (data) {
              calendar.fullCalendar('refetchEvents');
              alert("Actualizado satisfactoriamente");
            },
            error: function (data) {
              alert("Hay un problema. Comuníquese con IT");
            }
          

        });
  }
}

function nuevo_evento(){
    var title =  document.getElementById('title').value;
    var inicio =  document.getElementById('start').value;
    var fin =  document.getElementById('end').value;
    var desc =  document.getElementById('desc').value;
    var estado_camioneta = document.querySelector('#camioneta1');
    
    if (estado_camioneta.checked == true){
      $.ajax({
        type:"GET",
        url:'add_event/',
        data: {'title': 'Camioneta Administrativa', 'start': inicio, 'end': fin,'desc_evento':'Disponible', 'color':'#6ec0ff'},
        dataType: "json",
        success: function (data) {
          alert("Actualizado Satidfactoriamente.")
          calendar.fullCalendar('refetchEvents');
        
        },
        error: function (data) {
          alert("No se pudo guardar. Comuníquese con IT")
        }
      });
    
    }
  
    else {
      
      $.ajax({
        type:"GET",
        url:'add_event/',
        data: {'title': title, 'start': inicio, 'end': fin, 'desc_evento': desc, 'color': '#ffff6e'},
        dataType: "json",
        success: function (data) {
          alert("Actualizado Satisfactoriamente.")
          calendar.fullCalendar('refetchEvents');
        
        },
        error: function (data) {
          alert("No se pudo guardar. Comuníquese con IT")
        }
      });
    }
  }


$(document).ready(function() {
    var calendar = $('#calendar').fullCalendar({
      timezone: 'local',
      locale: 'es',
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      events: 'all_events_wchis/',
      selectable: true,
      selectHelper: true,
      editable: false,
      eventLimit: true,
      
      
      eventDrop: function (event){
        if (confirm("Está seguro que desea eliminar?")){
          var id = event.id;
          $.ajax({
          type:"GET",
          url:"remove_event/",
          data: {'id': id},
          dataType: "json",
          success: function (data) {
              calendar.fullCalendar('refetchEvents');
              alert("Actualizado satisfactoriamente");
            },
            error: function (data) {
              alert("Hay un problema. Comuníquese con IT");
            }
          

        });
        }
    },
      eventResize: function (event){
        var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ssZ");
        var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ssZ");
        var title = event.title;
        var id = event.id;
        $.ajax({
          type:"GET",
          url:"update_event/",
          data: {'title': title, 'start':start, 'end':end, 'id':id},
          dataType: "json",
          success: function (data) {
              calendar.fullCalendar('refetchEvents');
              alert("Actualizado satisfactoriamente");
            },
            error: function (data) {
              alert("Hay un problema. Comuníquese con IT");
            }
        });
      },

      eventClick: function (event){
        
        var id = event.id;
        var title = event.title;
        var start =  $.fullCalendar.formatDate(event.start, "YYYY-MM-DD HH:mm:ss");
        var end = $.fullCalendar.formatDate(event.end, "YYYY-MM-DD HH:mm:ss");
        var ruta = event.extendedProps.ruta;
        var transportista = event.extendedProps.transportista;
        var asientos = event.extendedProps.asientos;
        var descri = event.extendedProps.descripcion;
        var de = event.desc;

        if(asientos == 0){
          const btnbook = document.getElementById('bookingsw');
          btnbook.disabled = true; 
        }
        else{
          const btnbook = document.getElementById('bookingsw');
          btnbook.disabled = false; 

        }
        
        var inputT = document.getElementById("titlesw");
        var inputI = document.getElementById("startsw");
        var inputF = document.getElementById("endsw");
        var inputdesc = document.getElementById("descsw");
        var inputruta = document.getElementById("rutasw");
        var inputranspo = document.getElementById("transposw");
        var inputasientos = document.getElementById("asientossw");
        var inputID = document.getElementById("id");
        
        if(title == 'Camioneta Administrativa'){
          document.getElementById("camioneta1sw").checked = true;

        }


        $('#Show-Event').modal('show'); 
        inputT.value = title;
        inputI.value = start; 
        inputF.value = end;
        inputruta.value = ruta;
        inputranspo.value = transportista;
        inputdesc.textContent = descri; 
        inputasientos.value = asientos;
        inputID.value = id;

        document.getElementById('cierrasw').onclick = function() {
          $('#Show-Event').modal('hide');
          
        }

        document.getElementById('cierra-arriba').onclick = function() {
          $('#Show-Event').modal('hide'); 
          
        }


    document.getElementById('grababk').onclick = function() {
    var depar =  document.getElementById('departamento').value;
    var pasajero =  document.getElementById('pasajero').value;
    var evento_id =  document.getElementById('idbk').value;
    var justifica = document.getElementById('justificacion').value;
    var tipo = 1;
    $(this).attr("disabled",true)
    
        $.ajax({
        type:"GET",
        url:'ajax_save_booking/',
        data: {'depar': depar, 'pasajero': pasajero, 'evento_id': evento_id,'justifica':justifica,'tipo':tipo},
        dataType: "json",
        success: function (data) {
          console.log(data.status);
          calendar.fullCalendar('refetchEvents');
              $("#Show-Booking").modal('hide');
              alert("Actualizado satisfactoriamente");
              
          
        
        },
        error: function (data) {
          alert("No se pudo guardar. Comuníquese con IT");
         
        },
        
      })
      }

        document.getElementById('eliminasw').onclick = function() {
          if (confirm("Está seguro que desea eliminar?")){
          var id = event.id;
          $.ajax({
          type:"GET",
          url:"remove_event/",
          data: {'id': id},
          dataType: "json",
          success: function (data) {
              calendar.fullCalendar('refetchEvents');
              $('#Show-Event').modal('hide'); 
              
            },
            error: function (data) {
              alert("Hay un problema. Comuníquese con IT");
            }
          

        });
        }
        }

      }
    
    });

  })

</script>
{% endblock %}