{% extends 'base.html' %}
{% load bootstrap %}
{% load widget_tweaks %}
{% load filters %}

{% block extrahead %}


<style>
#cbox1
{
  /* Checkbox text */
  font-size: 200%;
  display: inline;
}
</style>
{% endblock %}

{% block content %}
<!-- <div class="loader"></div> -->
<div class="jumbotron" style="width: 75%; margin:auto; padding-top: 25px; margin-top: 50px; margin-bottom: 25px;">
        <h2 class="display-5">Registro de Salida/Movimiento de Activos (ECMAN R-1-5)</h2>
        {% if estado == 1 %}
                <div class="alert alert-danger col" style="text-align: center;">
                        <h1>EL ACTIVO NO HA SIDO RECEPCIONADO EN BODEGA</h1>
                        <h1>COMUNIQUESE CON BODEGA</h1>
                </div>
        {% endif %}
        <form method="POST"> 
        {% csrf_token %}
        <div class="form-row">
                <div class="form-group col-md-4" >
                        <label for="{{ form.activo_codigo.label }}">{{ form.activo_codigo.label }}</label>   
                        {% render_field form.codigo value=codigo class="form-control"  readonly="True" %} 
                        {% render_field form.departamento class="form-control" hidden=True %} 
                        {% render_field form.grupo class="form-control" hidden=True %} 
                        {% render_field form.activo_codigo class="form-control" hidden=True %} 
                </div>
                <div class="form-group col-md-4" >
                        <label for="{{ form.ubica_ubica.label }}">{{ form.ubica_ubica.label }}</label>   
                        <input type="text" class="form-control" name="ubi" id="ubi" readonly value="{{ubi}}"></input> 
                </div>
                <div class="form-group col-md-4" >
                        <label for="{{ form.ubica_area.label }}">{{ form.ubica_area.label }}</label>   
                        <input type="text" class="form-control" name="ar" id="ar" readonly value="{{ar}}"></input> 
                        
                </div>
              
        </div>
        <div class="form-row">
                <div class="form-group col-md-4" >
                        <label for="{{ form.activo_tipo.label }}">{{ form.activo_tipo.label }}</label>   
                        {% render_field form.activo_tipo class="form-control"  readonly="True" %} 
                </div>
                <div class="form-group col-md-4" >
                        <label for="{{ form.activo_num_serie.label }}">{{ form.activo_num_serie.label }}</label> 
                        {% render_field form.activo_num_serie class="form-control"  readonly="True" %}      
                </div>
                <div class="form-group col-md-4" >
                        <label for="{{ form.marca.label }}">{{ form.marca.label }}</label> 
                        {% render_field form.marca class="form-control"  readonly="True" %} 
                </div>
        </div>
        <div class="form-row">
                <div class="form-group col-md-12" >
                        <label for="{{ form.detalle_activo.label }}">{{ form.detalle_activo.label }}</label> 
                        {% render_field form.detalle_activo class="form-control"  readonly="True" %} 
                </div>
        </div>
        <div class="form-row">

                <div class="form-group col-md-6">  
                        <label for="{{ form.sale_por.label }}">{{ form.sale_por.label }}</label> 
                        {{ form.sale_por }}      
                </div>
                
                <div class="col-md-3" id="fecha_retorno">
                        <label for="{{ form.fecha_estimada_retorno.label }}">{{ form.fecha_estimada_retorno.label }}</label> 
                        {{ form.fecha_estimada_retorno }}
                </div>
                <div class="col-md-3">
                        <label for="{{ form.hora_salida.label }}">{{ form.hora_salida.label }}</label> 
                        {{ form.hora_salida }}
                </div>
        </div>

        <div class="form-row">

                <div class="form-group col-md-6">  
                        <label for="{{ form.solicitado_por.label }}">{{ form.solicitado_por.label }}</label> 
                        {{ form.solicitado_por }}      
                </div>
                
                <div class="col-md-6">
                        <label for="{{ form.persona_autoriza_dep.label }}">{{ form.persona_autoriza_dep.label }}</label> 
                        {{ form.persona_autoriza_dep }}
                </div>
        </div>

        <div class="form-row" id="movimientos">
                <div class="form-group col-md-12">
                        <h4>Registre Nueva Ubicación del Activo</h4>
                </div>
                <div class="form-group col-md-3" >
                        <label>Ubicación</label> 
                        <select name="ubica" id="ubica" style="width: 100%;" class="form-control">
                                <option value="0" selected>----</option>
                                {% for i in ubicacion %}
                                        <option value="{{ i.id }}">{{ i.ubica_nombre }}</option>
                                {% endfor %}
                        </select>
                </div>
                <div class="form-group col-md-3" >
                        <label>Sector</label> 
                        <select name="areas" id="areas" style="width: 100%;" class="form-control">
                                <option value="0" selected>----</option>
                                {% for i in area %}
                                        <!-- <option value="{{ i.area_codigo }}" data-chained="{{ i.area_departamento_id }}">{{ i.area_nombre }}</option> -->
                                        <option value="{{ i.area_codigo }}">{{ i.area_nombre }}</option>
                                        {% endfor %}
                        </select>
                </div>
        </div>
        <div class="form-row">
                <div class="form-group col-md-12" >
                        <label for="{{ form.motivo.label }}">{{ form.motivo.label }}</label> 
                        {{ form.motivo }}
                </div>
        </div>
        <div class="form-row">
                <!-- <div class="form-group col-md-4" >
                        <label for="{{ form.empresa_mantenimiento.label }}">{{ form.empresa_mantenimiento.label }}</label> 
                        {{ form.empresa_mantenimiento }}
                </div>  -->

                <div class="row" id="proveedor">
                        <div class="col-8">
                        
                        <label for="{{ form.empresa_mantenimiento.label }}">{{ form.empresa_mantenimiento.label }}</label>
                        <select name="proveedor" id="id_proveedor" style="width: 100%;" class="form-control">
                                <option value="" selected>----</option>
                                {% for i in proveedor %}
                                        <option value="{{ i.codigo_id.nombre_empresa }}">{{ i.codigo_id.nombre_empresa }}</option>
                                {% endfor %}
                        </select>
                </div>
                <div class="col-4">
                        <label><input type="checkbox" name="cbox1" id="cbox1" style="margin-top:45px;size:40px;transform: scale(1.2);"> Otra</label>
                </div>
                </div>

                
        </div>
        <pre></pre>
        <div class="form-row" id="otraempresa">
                <div class="form-group col-md-6" >
                        <label>Ingrese el nombre de Otra empresa o persona </label> 
                        <input type="text" name="otraempresa" id="otraempresa" class="form-control">
                </div>
        </div>
        <div class="form-row">
                <div class="form-group col-md-3" >
                        <label for="{{ form.persona_registra_en_proyecto.label }}">Registra</label> 
                        {% render_field form.persona_registra_en_proyecto value=registra hidden=True %}
                        <input type="text" name="usuario" id="usuario" class="form-control" readonly value="{{ user }}">
                </div>
        </div>

        
        
                <button id="guardar" type="submit" class="btn btn-primary btn-lg">Guardar</button>
        </form>
</div>

{% endblock content %}

{% block extrajs %}
<script>
//$('#activo_depar').val(113);
// $("#areas").chained("#depar"); 
//$('#activo_area').val(41);
$("#otraempresa").hide();
$("#id_proveedor").removeAttr("required")

$(document).ready(function() {
    //set initial state.
    $('#textbox1').val(this.checked);

    $('#cbox1').change(function() {
        if(this.checked) {
            $("#otraempresa").show();
            $("#id_proveedor").prop("required",false);
        }
        else{
                $("#otraempresa").hide();  
                $("#id_proveedor").prop("required",true); 
        }
                
    });
});

$(document).ready(function(){
        var estado = '{{estado}}'
        if (estado == 1) {
                $('#guardar').hide();
        }
})

  function ordenarSelect(id_componente)
    {
      var selectToSort = jQuery('#' + id_componente);
      var optionActual = selectToSort.val();
      selectToSort.html(selectToSort.children('option').sort(function (a, b) {
        return a.text === b.text ? 0 : a.text < b.text ? -1 : 1;
      })).val(optionActual);
    }
    $(document).ready(function () {
      ordenarSelect('id_activo_codigo');
    });

    $('#id_activo_codigo').change(function(){
            $('#id_codigo').val($('#id_activo_codigo option:selected').text())
    })

  $(document).ready(function(){
    $('#id_persona_retira').val('{{ user.username }}')
  })

  $(window).on("load", function() {
        $(".loader").fadeOut("slow");
    });

    $(document).ready(function() {    
        $('#guardar').on('click', function(){
            //Añadimos la imagen de carga en el contenedor
            $(".loader").show();
            $(window).on("load", function(){
                $(".loader").fadeOut("slow");
            });
        });              
    });

    $(document).ready(function(){
        let descripcion = '{{ desc }}';
        document.getElementById('id_detalle_activo').innerHTML = descripcion
    });
    $(document).ready(function(){
        $("#movimientos").hide();
    });
    $("#id_sale_por").change(function(){
        var opcion = $(this).val();

        if (opcion == "4"){
                $("#movimientos").show();
                $("#retorno").hide().val("");
                $("#fecha_retorno").hide().val("");
                $("#proveedor").hide().val("");
                $("#salidas").hide().val("");
                $("#id_proveedor").prop("required",false);
                $("#otraempresa").hide();
        }else{
                $("#movimientos").hide().val("");
                $("#retorno").show().val("");
                $("#fecha_retorno").show().val("");
                $("#proveedor").show().val("");
                $("#salidas").show().val("");
                $("#id_proveedor").prop("required",true);
        }
    });
</script>

{% endblock %}