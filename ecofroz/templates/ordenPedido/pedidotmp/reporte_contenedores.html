{% extends 'base.html' %}
<!-- {% load tz %} -->

{% block content %}
<div class="container" style="margin: 25px auto;">
  <div class="row">
    <div class="col-md 12 search">
      <form class="form-inline my-2 my-lg-0" method="GET" action="{% url 'personal:reporte_contenedor' %}">
        <div class="form-row">
          <div class="form-group col-auto">
            <label style="margin-right: 10px;">DESDE:</label>
            <input type="date" name="inicio" value="{{ inicio }}" required>
          </div>
          <div class="form-group col-auto">
            <label style="margin-right: 10px;">HASTA:</label>
            <input type="date" name="fin" value="{{ fin }}" required>
          </div>
          <div class="col-auto">
            <button class="btn btn-secondary my-2 my-sm-0" type="submit">Buscar</button>
          </div>
        </div>
      </form>
      <div class="row">
        <div class="form-group col-auto">
          <a class="btn btn-success" style="margin-top: 5px;" href="{% url 'personal:export_excel_conte' inicio fin %}">Exportar a Excel</a> 
        </div>
        <div class="form-group col-auto">
          <a class="btn btn-warning" style="margin-top: 5px;" href="{% url 'personal:reporte_contenedor' %}">Limpiar</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid">
    <table class="table table-boderless">
        <thead class="thead-dark" style="text-align: center;">
            <tr>
              <th>N°</th>
              <th>Chofer</th>
              <th>Placa</th>
              <th>Contenedor Ingreso</th>
              <th>Nombre</th>
              <th>Transportista</th>
              <th>Fecha Ingreso</th>
              <th>Hora Ingreso</th>
              <th>Sello 1</th>
              <th>Sello 2</th>
              <th>Contenedor Salida</th>
              <th>Fecha Salida</th>
              <th>Hora Salida</th>
            </tr>
        </thead>
        <tbody style="text-align: center;">
            {% for i in reg %}
            <tr>
              <td>{{ forloop.revcounter }}</td>
              <td>{{ i.chofer.cedula }}</td>
              <td>{{ i.placa }}</td>
              <td>{{ i.num_contenedor_ingreso }}</td>
              <td>{{ i.chofer.nombres }}</td>
              <td>{{ i.chofer.transportista.transportista }}</td>
              <td>{{ i.fch_ingreso }}</td>
              <td>{{ i.hr_ingreso_txt }}</td>
              <td>{{ i.sello_1 }}</td>
              <td>{{ i.sello_2 }}</td>
              <td>{{ i.num_contenedor_salida }}</td>
              <td>{{ i.fch_salida }}</td>
              <td>{{ i.hr_salida_txt }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div class="pagination">
  <span class="step-links">
      {% if reg.has_previous %}
          <a href="?inicio={{ inicio }}&fin={{ fin }}&page=1">&laquo; inicio</a>
          <a href="?inicio={{ inicio }}&fin={{ fin }}&page={{ reg.previous_page_number }}">previo</a>
      {% endif %}

      <span class="current">
          Page {{ reg.number }} of {{ reg.paginator.num_pages }}.
      </span>

      {% if reg.has_next %}
          <a href="?inicio={{ inicio }}&fin={{ fin }}&page={{ reg.next_page_number }}">próximo</a>
          <a href="?inicio={{ inicio }}&fin={{ fin }}&page={{ reg.paginator.num_pages }}">último &raquo;</a>
      {% endif %}
  </span>
</div>
{% endblock %}

{% block extrajs %}
<script>
  function readCookie(name) {
    var nameEQ = name + "="; 
    var ca = document.cookie.split(';');

    for(var i=0;i < ca.length;i++) {
      var c = ca[i];
      // alert(c)
      while (c.charAt(0)==' ') c = c.substring(1,c.length);
      if (c.indexOf(nameEQ) == 0) {
        var a = decodeURIComponent( c.substring(nameEQ.length,c.length) ).split(",");
        var dat = a[0]; 
        // alert(dat)
        // alert(decodeURIComponent( c.substring(nameEQ.length,c.length) ))
        return dat //decodeURIComponent( c.substring(nameEQ.length,c.length) );
      }

    }

    return null;

  };

  $(document).ready(function(){
    var dato = readCookie("acceso");

    if (dato){
      // alert(dato)
      // document.cookie = "acceso=0, expires=06 Sep 2020 23:59:59 GMT";
      // document.cookie = "acceso=0; max-age=0";
      // alert(document.cookie)
      // alert("paso1")
    } else {
      // document.cookie = "acceso=0; expires=08 Sep 2020 23:59:59 GMT";
      document.cookie = "acceso=0; max-age=3600";
      // alert(document.cookie)
      // alert("paso1 ele")
    };

    // alert(dato)
    var dato2 = readCookie("acceso");
    if (dato2==0) { 
      // alert("paso2")
      // alert(dato2)
      var verifica = '{{ cod }}';
      var ingreso = prompt('Ingrese el codigo de acceso', '');
      var dato = readCookie("acceso");

      if (ingreso == verifica) {
        alert('Acceso Concedido')
        document.cookie = "acceso=1; max-age=3600";
      } else {
        alert('Usted no tiene acceso a esta área')
        window.location.replace('{% url "home" %}')
      }

      // alert(dato);
    } //else if (ingreso == verifica) {
    //   alert('Acceso Concedido');
      
    // } else {
    //   alert('Usted no tiene acceso a esta área')
    //   window.location.replace('{% url "home" %}')
    // }
  });

  var comprueba = '{{msje2}}'
  if (comprueba == 'Error') {
    $(document).ready(function(){
      alert('{{ msje }}');
    })
  };
</script>
{% endblock %}